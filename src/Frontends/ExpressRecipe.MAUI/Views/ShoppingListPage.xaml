<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ExpressRecipe.MAUI.ViewModels"
             x:Class="ExpressRecipe.MAUI.Views.ShoppingListPage"
             x:DataType="vm:ShoppingListViewModel"
             Title="Shopping List">

    <Grid RowDefinitions="Auto,*,Auto">
        <!--Progress Header -->
        <Frame Grid.Row="0" Padding="16" Margin="8" CornerRadius="12" BackgroundColor="{StaticResource Primary}">
            <VerticalStackLayout Spacing="8">
                <Label Text="{Binding CompletedItems, StringFormat='{0} of {1} items'}"
                      TextColor="White"
                      FontSize="16"
                      FontAttributes="Bold"/>

                <ProgressBar Progress="{Binding ProgressPercentage}"
                            ProgressColor="White"
                            BackgroundColor="{StaticResource PrimaryDark}"/>
            </VerticalStackLayout>
        </Frame>

        <!-- Shopping List -->
        <RefreshView Grid.Row="1"
                    IsRefreshing="{Binding IsRefreshing}"
                    Command="{Binding RefreshCommand}">
            <CollectionView ItemsSource="{Binding Items}"
                           SelectionMode="None"
                           EmptyView="No items in shopping list">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:ShoppingItemViewModel">
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="Delete"
                                             BackgroundColor="{StaticResource Error}"
                                             Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ShoppingListViewModel}}, Path=DeleteItemCommand}"
                                             CommandParameter="{Binding .}"/>
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <Frame Margin="8,4" Padding="12" CornerRadius="8">
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                    <CheckBox Grid.Column="0"
                                            IsChecked="{Binding IsCompleted}"
                                            Color="{StaticResource Primary}"/>

                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                        <Label Text="{Binding ProductName}"
                                              FontSize="16"/>
                                        <Label Text="{Binding Category}"
                                              FontSize="12"
                                              TextColor="{StaticResource Gray600}"/>
                                    </VerticalStackLayout>

                                    <Label Grid.Column="2"
                                          Text="{Binding Quantity, StringFormat='Qty: {0}'}"
                                          VerticalOptions="Center"
                                          TextColor="{StaticResource Gray600}"/>
                                </Grid>
                            </Frame>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" Padding="16" ColumnDefinitions="*,*" ColumnSpacing="12">
            <Button Grid.Column="0"
                   Text="+ Add Item"
                   Command="{Binding AddItemCommand}"
                   BackgroundColor="{StaticResource Primary}"
                   TextColor="White"/>

            <Button Grid.Column="1"
                   Text="Clear Completed"
                   Command="{Binding ClearCompletedCommand}"
                   BackgroundColor="{StaticResource Gray400}"
                   TextColor="White"/>
        </Grid>
    </Grid>
</ContentPage>
